<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shawn's 21st Birthday - Invitation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"> <!-- For Music Icon -->
    <style>
        /* Import elegant fonts */
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Montserrat:wght@300;400;600&display=swap');
        /* Import an optional script font if desired - uncomment and add class below */
        /* @import url('https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap'); */


        /* Define Color Variables and RGBA for easy use */
        :root {
            --gold: #d4af37; /* Original gold */
            --light-gold: #ffd700; /* Brighter gold */
            --rich-gold: #b8860b; /* Darker, richer gold */
            --soft-white: #f0f0f0; /* Soft white for text */
            --dark-bg: #0d0d0d; /* Slightly lighter dark bg */
            --mid-bg: #1a1a1a; /* Mid-tone dark */
            --card-bg: #202020; /* Dark grey for card */
            --gold-rgb: 212, 175, 55; /* For use in rgba() */
            --bg-gradient: radial-gradient(circle at center, #1a1a1a 0%, var(--dark-bg) 60%, #000000 100%);
            --card-gradient: linear-gradient(145deg, #2a2a2a, #101010); /* Slightly darker card gradient */
            --button-gradient: linear-gradient(45deg, var(--rich-gold), var(--gold)); /* Richer button gradient */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow: hidden;
            position: relative;
            visibility: hidden; /* Hide initially to prevent FOUC */
            color: var(--soft-white); /* Use soft white as default text color */
        }

         /* Ensure body is visible after DOM load */
        body.loaded { visibility: visible; }


        /* Music Placeholder Style */
         .music-placeholder {
             position: fixed;
             bottom: 20px;
             right: 20px; /* Position on the right */
             z-index: 50;
             background: rgba(0, 0, 0, 0.5); /* Semi-transparent dark background */
             border: 1px solid rgba(var(--gold-rgb), 0.3);
             border-radius: 30px;
             padding: 8px 15px;
             display: flex;
             align-items: center;
             cursor: pointer;
             transition: all 0.3s ease;
             backdrop-filter: blur(8px);
             -webkit-backdrop-filter: blur(8px);
             color: var(--gold); /* Gold icon/text color */
             font-size: 1.1rem;
             font-weight: 600;
         }
         .music-placeholder i {
             margin-right: 8px;
         }
         .music-placeholder:hover {
             background: rgba(0, 0, 0, 0.7);
             border-color: rgba(var(--gold-rgb), 0.6);
             color: var(--light-gold);
         }


        /* Content Wrapper for stages */
        .content-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: calc(100vh - 40px);
            max-height: 100vh;
            overflow-y: auto;
            padding: 0;
            width: 100%;
            max-width: 650px;
             display: none; /* Initially hidden */
        }

        /* Custom Scrollbar for content-wrapper */
        .content-wrapper::-webkit-scrollbar { width: 8px; }
        .content-wrapper::-webkit-scrollbar-track { background: #333; border-radius: 10px; }
        .content-wrapper::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 10px; }
        .content-wrapper::-webkit-scrollbar-thumb:hover { background: var(--light-gold); }


        .stage {
            display: none; /* Controlled by JS */
            animation: fadeInScale 0.8s ease-out forwards;
            max-width: 600px;
            width: 100%;
            padding: 40px;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.8);
            background: var(--card-gradient);
            border: 1px solid rgba(var(--gold-rgb), 0.2); /* Softer border */
            border-radius: 20px;
            position: relative;
            flex-shrink: 0;
            flex-grow: 0;
             margin: 20px auto;
             box-shadow: 0 20px 50px rgba(0, 0, 0, 0.7), 0 0 30px rgba(var(--gold-rgb), 0.2); /* Enhanced shadow */
        }

         @keyframes fadeInScale {
             from { opacity: 0; transform: scale(0.9) translateY(20px); }
             to { opacity: 1; transform: scale(1) translateY(0); }
         }

         @keyframes fadeIn { /* Keep existing fadeIn */
              from { opacity: 0; }
              to { opacity: 1; }
         }


        /* Ensure elements *within* stages get their animation delays */
        /* Reset animation-delay to 0 first for direct children of .stage */
        .stage > * {
             animation-delay: 0s !important; /* Override any default animation delay */
         }

        /* Re-apply specific delays to elements needing them within the stage */
        .stage#mainCard .crown { animation-delay: 0.3s !important; } /* Delay crown slightly */
        .stage#mainCard .invitation-intro { animation-delay: 0.6s !important; } /* Intro delay */
        .stage#mainCard .title { animation-delay: 0.9s !important; } /* Title delay */
        .stage#mainCard .description { animation-delay: 1.2s !important; } /* Description text delay */
        .stage#mainCard .celebrant-name { animation-delay: 1.5s !important; } /* Name delay */
        .stage#mainCard .age-highlight { animation-delay: 1.8s !important; } /* Age delay */

        /* Details Section specific delays (Shifted) */
        .stage#mainCard .details-section { animation-delay: 2.1s !important; } /* Delay the whole section */
        .stage#mainCard .details-section .detail-item:nth-child(1) { animation-delay: 0s !important; } /* Animate detail items relative to section */
        .stage#mainCard .details-section .detail-item:nth-child(2) { animation-delay: 0.2s !important; }
        .stage#mainCard .details-section .detail-item:nth-child(3) { animation-delay: 0.4s !important; }
        .stage#mainCard .detail-item:nth-child(4) { animation-delay: 0.6s !important; }

        .stage#mainCard .next-btn { animation-delay: 3s !important; } /* Button delay */


        /* Thank You Stage specific delays */
         .stage#thankYouSection .thank-you-title { animation-delay: 0.5s !important; }
         .stage#thankYouSection .thank-you-message { animation-delay: 0.8s !important; }
         .stage#thankYouSection .see-you-message { animation-delay: 1.1s !important; }


         /* Keyframes for fading out */
        @keyframes fadeOut {
             from { opacity: 1; transform: scale(1); }
             to { opacity: 0; transform: scale(0.95); }
         }
         .fade-out {
             animation: fadeOut 0.5s ease-out forwards;
         }


        /* Back button */
        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(var(--gold-rgb), 0.1);
            color: var(--gold);
            border: 1px solid rgba(var(--gold-rgb), 0.4);
            padding: 8px 15px;
            font-size: 0.9rem;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 50;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            font-weight: 600;
        }

        .back-btn.hidden {
             display: none !important;
         }


        /* Floating particles background */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--light-gold);
            border-radius: 50%;
            animation: float 8s infinite linear;
        }

        @keyframes float {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.5; } /* Softer entry */
            90% { opacity: 0.5; } /* Stay opaque longer */
            100% { transform: translateY(-10vh) rotate(360deg); opacity: 0; }
        }

        /* Click/tap sparkle effect */
        .click-sparkle {
            position: fixed;
            width: 10px;
            height: 10px;
            background: radial-gradient(circle, white 0%, var(--light-gold) 50%, transparent 100%);
            border-radius: 50%;
            pointer-events: none;
            z-index: 998;
            animation: sparkleFadeOut 0.8s ease-out forwards;
            transform-origin: center;
        }

        @keyframes sparkleFadeOut {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(0); opacity: 0; }
        }

        /* Shimmer effect for titles */
         .shimmering {
            position: relative;
            overflow: hidden;
            display: inline-block;
            vertical-align: middle;
            z-index: 0;
        }

        .shimmering .shimmer-after {
            display: block;
            position: absolute;
            top: 0;
            left: -200%;
            width: 200%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
            animation: shimmer 4s infinite cubic-bezier(0.25, 0.1, 0.25, 1);
            z-index: 1;
            pointer-events: none;
        }

        @keyframes shimmer {
            0% { left: -200%; }
            100% { left: 200%; }
        }


        /* Stage 1: Envelope */
        .envelope-container {
            position: relative;
            width: 400px;
            height: 280px;
            cursor: pointer;
            z-index: 10;
            transition: all 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            animation: pulse-float 3s infinite ease-in-out;
        }
         @keyframes pulse-float {
             0%, 100% { transform: translateY(0); box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5), 0 0 20px rgba(var(--gold-rgb), 0.3); }
             50% { transform: translateY(-10px); box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5), 0 0 40px rgba(var(--gold-rgb), 0.6); }
         }


        .envelope {
            width: 100%;
            height: 100%;
            background: linear-gradient(145deg, var(--card-bg), var(--mid-bg));
            border: 2px solid var(--gold);
            border-radius: 10px;
            position: relative;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }

        .envelope::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 200px solid transparent;
            border-right: 200px solid transparent;
            border-top: 140px solid var(--gold);
            z-index: 2;
        }

        .envelope::after {
            content: '';
            position: absolute;
            top: 5px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 195px solid transparent;
            border-right: 195px solid transparent;
            border-top: 135px solid var(--mid-bg);
            z-index: 3;
        }

        .envelope-seal {
            position: absolute;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, var(--light-gold), var(--gold));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            z-index: 4;
            box-shadow: 0 5px 15px rgba(var(--gold-rgb), 0.5);
            animation: seal-bounce 1s ease-out forwards;
             animation-delay: 0.5s;
             opacity: 0;
        }

        @keyframes seal-bounce {
             0% { transform: translateX(-50%) scale(0.8); opacity: 0; }
             50% { transform: translateX(-50%) scale(1.1); opacity: 1; }
             70% { transform: translateX(-50%) scale(0.9); }
             100% { transform: translateX(-50%) scale(1); opacity: 1;}
        }


        .envelope-text {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            color: var(--gold);
            font-family: 'Playfair Display', serif;
            font-size: 1.2rem;
            text-align: center;
            z-index: 2;
            width: 100%;
            padding: 0 10px;
             animation: text-slide-in 1s ease-out forwards;
             opacity: 0;
             animation-delay: 1s;
        }

        @keyframes text-slide-in {
             from { transform: translateX(-50%) translateY(20px); opacity: 0; }
             to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }


        /* Stage 2: Main Invitation */
         #mainCard { text-align: center; }

         .crown {
            font-size: 4.5rem;
            margin-bottom: 15px; /* Reduced margin for intro text */
            animation: crownSpin 4s infinite;
            display: block;
            margin-left: auto;
            margin-right: auto;
            color: var(--light-gold);
             animation: fadeIn 1s ease-out forwards; /* Simple fade in */
             opacity: 0;
        }

        @keyframes crownSpin {
            0% { transform: rotateY(0deg) scale(1); }
            50% { transform: rotateY(360deg) scale(1.05); }
            100% { transform: rotateY(0deg) scale(1); }
        }

         .invitation-intro {
             font-family: 'Playfair Display', serif; /* Or 'Great Vibes', cursive; if imported */
             font-style: italic;
             font-size: 1.8rem; /* Slightly larger */
             color: var(--soft-white); /* Soft white */
             margin-bottom: 10px; /* Space between intro and title */
             text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
             animation: fadeIn 1s ease-out forwards;
             opacity: 0; /* Starts invisible for animation */
         }

        .title {
            font-family: 'Playfair Display', serif;
            font-size: 3.5rem;
            font-weight: 700;
            color: var(--gold);
            margin-bottom: 10px; /* Reduced margin */
            text-shadow: 3px 3px 8px rgba(0, 0, 0, 0.8);
            animation: textGlow 2.5s infinite alternate, fadeIn 1s ease-out forwards; /* Add fade in */
            opacity: 0;
        }

        @keyframes textGlow {
            from { text-shadow: 3px 3px 8px rgba(0, 0, 0, 0.8), 0 0 25px rgba(var(--gold-rgb), 0.5); }
            to { text-shadow: 3px 3px 8px rgba(0, 0, 0, 0.8), 0 0 50px rgba(var(--gold-rgb), 1); }
        }

         /* Description text */
        .description { /* Changed from p to class for clarity */
             color: var(--soft-white);
             font-style: italic;
             margin-bottom: 20px;
             animation: fadeIn 1s ease-out forwards;
             opacity: 0;
             text-align: center;
             text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
         }


        .celebrant-name {
            font-family: 'Playfair Display', serif;
            font-size: 2.8rem;
            font-weight: 700;
            color: var(--soft-white); /* Soft white */
            margin-bottom: 30px;
            letter-spacing: 4px;
            animation: slideInText 1.5s ease-out forwards;
            opacity: 0;
             text-shadow: 2px 2px 5px rgba(0,0,0,0.5);
        }

        @keyframes slideInText {
            0% { opacity: 0; transform: translateX(-50px); }
            100% { opacity: 1; transform: translateX(0); }
        }

        .age-highlight {
            font-family: 'Playfair Display', serif;
            font-size: 6rem;
            font-weight: 700;
            color: var(--gold);
            margin: 40px 0;
            animation: ageGlow 2.5s infinite, bounceIn 1s ease-out forwards;
            opacity: 0;
            animation-fill-mode: forwards;
             text-shadow: 3px 3px 10px rgba(0, 0, 0, 0.8);
        }

        @keyframes ageGlow {
            0%, 100% { transform: scale(1) rotate(0deg); text-shadow: 0 0 20px rgba(var(--gold-rgb), 0.5); }
            50% { transform: scale(1.1) rotate(-2deg); text-shadow: 0 0 40px rgba(var(--gold-rgb), 1); }
        }
         @keyframes bounceIn { /* Keep existing bounceIn */
              0% { transform: scale(0.3); opacity: 0; }
              50% { transform: scale(1.05); opacity: 1; }
              70% { transform: scale(0.9); }
              100% { transform: scale(1); opacity: 1; }
         }


        .details-section {
            margin: 50px 0;
            padding: 40px;
            background: rgba(0, 0, 0, 0.5); /* Keep semi-transparent background */
            border-radius: 20px;
            border: 1px solid rgba(var(--gold-rgb), 0.3); /* Softer border */
             text-align: center;
             opacity: 0; /* Start invisible for animation */
             animation: fadeIn 1s ease-out forwards; /* Animation for the section itself */
        }

        .detail-item {
            margin: 25px 0;
            color: var(--soft-white); /* Use soft white */
            font-size: 1.3rem;
            animation: detailFadeIn 0.8s ease-out forwards;
            opacity: 0; /* Starts invisible for animation */
        }

        @keyframes detailFadeIn {
             from { opacity: 0; transform: translateY(10px);} /* Add slight movement */
             to { opacity: 1; transform: translateY(0);}
         }


        .detail-label {
            color: var(--light-gold);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 8px;
            display: block;
            font-size: 1rem;
        }

        .detail-value {
            font-weight: 400; /* Standard weight for values */
        }

        .next-btn {
            background: var(--button-gradient);
            color: #000; /* Black text on gold button */
            border: none;
            padding: 15px 50px;
            font-size: 1.3rem;
            font-weight: 700;
            border-radius: 35px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-top: 30px;
            animation: buttonPulse 2s infinite, fadeIn 1s ease-out forwards;
            opacity: 0;
            position: relative;
            overflow: hidden;
            z-index: 2;
             display: block;
            margin-left: auto;
            margin-right: auto;
             box-shadow: 0 5px 15px rgba(var(--gold-rgb), 0.3);
        }

        @keyframes buttonPulse {
             0%, 100% { transform: scale(1); box-shadow: 0 5px 15px rgba(var(--gold-rgb), 0.3); }
             50% { transform: scale(1.05); box-shadow: 0 5px 25px rgba(var(--gold-rgb), 0.6); }
        }


        .next-btn::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.5), transparent);
            transition: left 0.4s ease-in-out;
            z-index: -1;
        }
        .next-btn:hover::before { left: 100%; }


        /* Stage 3 (formerly 5): Thank You */
        #thankYouSection { text-align: center; }

        .thank-you-title {
            font-family: 'Playfair Display', serif;
            font-size: 4rem;
            color: var(--light-gold);
            margin-bottom: 25px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
            animation: textGlow 2s infinite alternate, rubberBand 1s ease-out forwards; /* Keep rubberBand */
            opacity: 0;
        }
         @keyframes rubberBand { /* Keep existing rubberBand */
              0% { transform: scale3d(1, 1, 1); opacity: 0; }
              30% { transform: scale3d(1.25, 0.75, 1); opacity: 1; }
              40% { transform: scale3d(0.75, 1.25, 1); }
              50% { transform: scale3d(1.15, 0.85, 1); }
              65% { transform: scale3d(.95, 1.05, 1); }
              75% { transform: scale3d(1.05, .95, 1); }
              100% { transform: scale3d(1, 1, 1); opacity: 1; }
         }


        .thank-you-message {
            color: var(--soft-white); /* Use soft white */
            font-size: 1.5rem;
            margin-bottom: 50px;
            line-height: 1.6;
            animation: fadeIn 1s ease-out forwards;
            opacity: 0;
             text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }

        .see-you-message {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            color: var(--gold);
            font-weight: 700;
            animation: pulse-glow 2s infinite, fadeIn 1s ease-out forwards;
            opacity: 0;
             text-shadow: 2px 2px 5px rgba(0,0,0,0.5);
        }

         @keyframes pulse-glow { /* Keep existing pulse-glow */
              0%, 100% { text-shadow: 2px 2px 5px rgba(0,0,0,0.5), 0 0 10px rgba(var(--gold-rgb), 0.3); }
              50% { text-shadow: 2px 2px 5px rgba(0,0,0,0.5), 0 0 25px rgba(var(--gold-rgb), 0.6); }
         }


        /* Fireworks effect */
        .firework {
            position: fixed;
            width: 6px;
            height: 6px;
            background: var(--gold);
            border-radius: 50%;
            pointer-events: none;
            z-index: 1001;
            transform-origin: center;
            animation: fireworkExplode 1.2s ease-out forwards;
        }

        @keyframes fireworkExplode {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(25); opacity: 0; }
        }

        /* Confetti Effect */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            opacity: 0.9;
            pointer-events: none;
            z-index: 999;
             /* Background color set by JS */
        }

        @keyframes confettiFall {
             0% { transform: translateY(-10vh) rotateZ(0deg); opacity: 1; }
             100% { transform: translateY(105vh) rotateZ(720deg); opacity: 0; }
         }

        @keyframes confettiSideways {
             0% { transform: translateX(0); }
             100% { transform: translateX(var(--confetti-end-x, 0vw)); }
         }


        .hidden { display: none !important; }


        /* Media query for mobile adjustments */
        @media (max-width: 768px) {
            body { padding: 10px; }
             .content-wrapper { min-height: calc(100vh - 20px); max-width: 100%; padding: 0 10px;}

            .envelope-container { width: 90%; max-width: 320px; height: 220px; }
             .envelope::before { border-left: 160px solid transparent; border-right: 160px solid transparent; border-top: 110px solid var(--gold); }
             .envelope::after { border-left: 155px solid transparent; border-right: 155px solid transparent; border-top: 105px solid var(--mid-bg); }
            .envelope-seal { width: 50px; height: 50px; font-size: 1.8rem; top: 40px; }
            .envelope-text { font-size: 1rem; bottom: 30px; }
             @keyframes seal-bounce { 0% { transform: translateX(-50%) scale(0.8); opacity: 0; } 50% { transform: translateX(-50%) scale(1.1); opacity: 1; } 100% { transform: translateX(-50%) scale(1); opacity: 1;} }
             @keyframes text-slide-in { from { transform: translateX(-50%) translateY(10px); opacity: 0; } to { transform: translateX(-50%) translateY(0); opacity: 1; } }
             @keyframes pulse-float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

            .music-placeholder { /* Mobile adjustments for music placeholder */
                bottom: 10px;
                right: 10px;
                padding: 6px 12px;
                font-size: 1rem;
             }
             .music-placeholder i { margin-right: 5px; }


            .stage { padding: 30px 15px; }
            @keyframes fadeInScale { from { opacity: 0; transform: scale(0.95) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
             @keyframes fadeOut { from { opacity: 1; transform: scale(1); } to { opacity: 0; transform: scale(0.98); } }

            .crown { font-size: 3.5rem; margin-bottom: 10px; animation-delay: 0.3s !important; }
             .invitation-intro { font-size: 1.4rem; margin-bottom: 8px; animation-delay: 0.6s !important; }
            .title { font-size: 2.8rem; margin-bottom: 8px; animation-delay: 0.9s !important; }
             .description { font-size: 1rem; margin-bottom: 15px; animation-delay: 1.2s !important; }
            .celebrant-name { font-size: 2rem; letter-spacing: 2px; margin-bottom: 20px; animation-delay: 1.5s !important; }
            .age-highlight { font-size: 4.5rem; margin: 30px 0; animation-delay: 1.8s !important; }
             @keyframes ageGlow { 0%, 100% { transform: scale(1); text-shadow: 0 0 20px rgba(var(--gold-rgb), 0.5); } 50% { transform: scale(1.1); text-shadow: 0 0 40px rgba(var(--gold-rgb), 1); } }


            .details-section { padding: 25px; margin: 30px 0; animation-delay: 2.1s !important;} /* Mobile delay for section */
             /* Detail item delays relative to section start */
             .stage#mainCard .details-section .detail-item:nth-child(1) { animation-delay: 0s !important; }
             .stage#mainCard .details-section .detail-item:nth-child(2) { animation-delay: 0.2s !important; }
             .stage#mainCard .details-section .detail-item:nth-child(3) { animation-delay: 0.4s !important; }
             .stage#mainCard .details-section .detail-item:nth-child(4) { animation-delay: 0.6s !important; }


             .detail-label { font-size: 0.9rem; letter-spacing: 1px; margin-bottom: 5px;}
            .detail-value { font-size: 1.1rem; }

            .next-btn { padding: 12px 30px; font-size: 1.1rem; margin-top: 25px; border-radius: 30px; font-weight: 600;
                 animation-delay: 3s !important; /* Mobile delay for button */
             }


            /* Mobile Thank You Adjustments */
            #thankYouSection .thank-you-title { font-size: 3rem; margin-bottom: 20px; animation-delay: 0.5s !important; }
            #thankYouSection .thank-you-message { font-size: 1.1rem; margin-bottom: 30px; animation-delay: 0.8s !important; }
            #thankYouSection .see-you-message { font-size: 2rem; animation-delay: 1.1s !important; }

        }
    </style>
</head>
<body class="loaded">
    <!-- Background Music Element -->
    <!-- IMPORTANT: Replace the src below with the actual path to YOUR music file -->
    <audio id="backgroundMusic" src="Craig David - Insomnia (Lyrics).mp3" loop preload="auto"></audio>

     <!-- Music Placeholder/Control -->
     <!-- We use a div to style, and link it to the audio element via JS -->
     <div class="music-placeholder" id="musicPlaceholder">
         <i class="fas fa-music"></i> <!-- Music icon -->
         <span id="musicStatusText">Music</span> <!-- Status text (optional) -->
     </div>


    <!-- Back Button -->
    <!-- Add the 'hidden' class initially in HTML as well -->
    <button class="back-btn hidden" id="backButton" onclick="goBack()">< Back</button>

    <!-- Floating particles -->
    <div class="particles" id="particles"></div>

    <!-- Stage 1: Envelope - Shows "You're Invited" and the seal -->
    <div class="envelope-container" id="envelope" onclick="openEnvelope()">
        <div class="envelope">
            <div class="envelope-seal">👑</div>
            <div class="envelope-text">
                <div style="font-weight: bold;">You're Invited!</div>
                <div style="font-size: 0.9rem; margin-top: 5px;">Click to Open</div>
            </div>
        </div>
    </div>

    <!-- Content Wrapper for other stages -->
    <div class="content-wrapper" id="contentWrapper">
        <!-- Stage 2: Main Invitation - Shows full details -->
        <div class="invitation-card stage" id="mainCard">
            <div class="crown">👑</div>

            <!-- Restored: "You are invited to..." text -->
            <div class="invitation-intro">You are invited to...</div>
            <!-- Restored: Main Title -->
            <h1 class="title" id="mainTitle">BIRTHDAY CELEBRATION</h1>
             <!-- Restored: Description -->
            <p class="description">Coming of Age Celebration</p>

            <!-- Restored: Name -->
            <h2 class="celebrant-name">SHAWN KIEFFER GOYENA</h2>
            <!-- Restored: Age Highlight -->
            <div class="age-highlight">21</div>

            <!-- Birthday Details Section -->
            <div class="details-section">
                <div class="detail-item">
                    <span class="detail-label">When</span>
                    <div class="detail-value">June 14, 2025 • 1:00 PM - 6:00 PM</div>
                </div>

                <div class="detail-item">
                    <span class="detail-label">Where</span>
                    <div class="detail-value">KW Party, Pasay City<br>Near Parqal</div>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Room Number</span>
                    <div class="detail-value">K99</div>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Dress Code</span>
                    <div class="detail-value">Casual Attire with Black Top</div>
                </div>
            </div>

            <!-- Button now goes directly to the Thank You stage -->
            <button class="next-btn" onclick="showThankYou()">View Final Message</button>
        </div>

        <!-- Stage 3: Thank You -->
        <div class="thank-you-section stage" id="thankYouSection">
            <!-- Shimmer class added via JS -->
            <h2 class="thank-you-title" id="thankYouTitle">THANK YOU!</h2>
            <p class="thank-you-message">
                Your presence at Shawn's 21st birthday celebration is the greatest gift of all. We can't wait to share this special milestone with you.
            </p>
            <p class="see-you-message">
                See You There! 🥳
            </p>
        </div>
    </div> <!-- End content-wrapper -->

    <script>
        let currentStage = 'envelope';
        const envelopeEl = document.getElementById('envelope');
        const contentWrapperEl = document.getElementById('contentWrapper');
        const mainCardEl = document.getElementById('mainCard');
        const thankYouSectionEl = document.getElementById('thankYouSection');
        const backButtonEl = document.getElementById('backButton');
        const backgroundMusic = document.getElementById('backgroundMusic');
        const musicPlaceholderEl = document.getElementById('musicPlaceholder'); // Get the placeholder element
        const musicStatusTextEl = document.getElementById('musicStatusText'); // Get status text
        const mainTitleEl = document.getElementById('mainTitle'); // Restored main title reference
        const thankYouTitleEl = document.getElementById('thankYouTitle');


        // --- Music Placeholder Logic ---
        let isMusicPlaying = false;

        if (musicPlaceholderEl && backgroundMusic) {
            // Initial text based on source
             if (!backgroundMusic.src || backgroundMusic.src.endsWith('path/to/your/music.mp3') || backgroundMusic.src === location.href) {
                 musicStatusTextEl.textContent = 'No Music';
                 musicPlaceholderEl.style.pointerEvents = 'none'; // Make non-clickable
                 musicPlaceholderEl.style.opacity = 0.5; // Dim it
                 musicPlaceholderEl.style.cursor = 'default';
             } else {
                 musicStatusTextEl.textContent = 'Play Music';
                 musicPlaceholderEl.style.pointerEvents = 'auto';
                 musicPlaceholderEl.style.opacity = 1;
                 musicPlaceholderEl.style.cursor = 'pointer';

                 // Handle click on placeholder
                 musicPlaceholderEl.addEventListener('click', () => {
                     if (isMusicPlaying) {
                         backgroundMusic.pause();
                     } else {
                         // Request play, handle potential auto-play blocks
                         const playPromise = backgroundMusic.play();
                         if (playPromise !== undefined) {
                             playPromise.catch(error => {
                                 console.log("Music play prevented:", error);
                                 // Optionally show a message to the user here
                                 // musicStatusTextEl.textContent = 'Click anywhere to enable music';
                             });
                         }
                     }
                 });

                 // Update icon/text when music state changes
                 backgroundMusic.addEventListener('play', () => {
                     isMusicPlaying = true;
                     musicPlaceholderEl.querySelector('i').className = 'fas fa-pause';
                     musicStatusTextEl.textContent = 'Pause Music';
                 });

                 backgroundMusic.addEventListener('pause', () => {
                     isMusicPlaying = false;
                     musicPlaceholderEl.querySelector('i').className = 'fas fa-play';
                     musicStatusTextEl.textContent = 'Play Music';
                 });
             }

             // Ensure music starts muted or at low volume if autoplay works but is quiet
             backgroundMusic.volume = 0.3; // Start at 30% volume
        } else if (musicPlaceholderEl) {
            // If music tag is missing but placeholder exists
             musicStatusTextEl.textContent = 'Music Error';
             musicPlaceholderEl.style.pointerEvents = 'none';
             musicPlaceholderEl.style.opacity = 0.5;
             musicPlaceholderEl.style.cursor = 'default';
        }


        // Add event listener for body click/tap for sparkles
        document.body.addEventListener('click', createClickSparkle);
        document.body.addEventListener('touchstart', createClickSparkle);

        // Function to create click/tap sparkles
        function createClickSparkle(e) {
            const sparkle = document.createElement('div');
            sparkle.className = 'click-sparkle';
            const x = e.clientX || (e.touches && e.touches[0].clientX);
            const y = e.clientY || (e.touches && e.touches[0].clientY);

            if (x === undefined || y === undefined) return;

            sparkle.style.left = (x - 5) + 'px';
            sparkle.style.top = (y - 5) + 'px';

            document.body.appendChild(sparkle);

            setTimeout(() => {
                if (document.body.contains(sparkle)) {
                    sparkle.remove();
                }
            }, 800);
        }

        // Create floating particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            if (!particlesContainer) return;
            for (let i = 0; i < 80; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 10 + 's';
                particle.style.animationDuration = (Math.random() * 5 + 5) + 's';
                const size = Math.random() * 3 + 3;
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                particlesContainer.appendChild(particle);
            }
        }

        // Create fireworks effect
        function createFireworks() {
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const firework = document.createElement('div');
                    firework.className = 'firework';
                    firework.style.left = (Math.random() * 80 + 10) + 'vw';
                    firework.style.top = (Math.random() * 40 + 5) + 'vh';

                    document.body.appendChild(firework);

                    setTimeout(() => {
                        if (document.body.contains(firework)) {
                            firework.remove();
                        }
                    }, 1200);

                }, i * 60);
            }
        }

        // Create confetti effect
        function createConfetti() {
             if (currentStage !== 'thankYou') return; // Only trigger on thank you page

            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.top = '-5vh';
                    const hue = Math.random() * 60; // Gold/Orange range
                    const lightness = Math.random() * 20 + 50; // Avoid too dark/light
                    confetti.style.backgroundColor = `hsl(${hue}, 100%, ${lightness}%)`;
                    confetti.style.width = confetti.style.height = `${Math.random() * 8 + 4}px`;

                     const fallDuration = `${Math.random() * 3 + 2}s`;
                     const fallDelay = `${Math.random() * 2}s`;

                     confetti.style.animation = `confettiFall ${fallDuration} ease-out forwards, confettiSideways ${fallDuration} ease-in-out forwards`;
                     confetti.style.animationDelay = `${fallDelay}, ${fallDelay}`;


                    confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                     const randomXEnd = (Math.random() - 0.5) * 60;
                     confetti.style.setProperty('--confetti-end-x', `${randomXEnd}vw`);


                    document.body.appendChild(confetti);

                    setTimeout(() => {
                        if (document.body.contains(confetti)) {
                            confetti.remove();
                        }
                    }, parseFloat(fallDuration) * 1000 + parseFloat(fallDelay) * 1000);

                }, i * 40);
            }
        }

        // Toggle shimmer effect on elements
        function toggleShimmer(element, add) {
            if (!element) return; // Check if element exists
            const existingShimmer = element.querySelector('.shimmer-after');

            if (add) {
                element.classList.add('shimmering');
                if (!existingShimmer) {
                    const shimmerEffect = document.createElement('span');
                    shimmerEffect.className = 'shimmer-after';
                    element.appendChild(shimmerEffect);
                }
            } else {
                element.classList.remove('shimmering');
                if(existingShimmer) {
                    existingShimmer.remove();
                }
            }
        }

        // Stage 1: Open envelope
        function openEnvelope() {
            if (currentStage !== 'envelope') return;

            // Auto-play music on first interaction (if not already playing and source is valid)
            if (backgroundMusic && !isMusicPlaying && backgroundMusic.src && !backgroundMusic.src.endsWith('path/to/your/music.mp3') && backgroundMusic.src !== location.href) {
                 const playPromise = backgroundMusic.play();
                 if (playPromise !== undefined) {
                     playPromise.catch(error => {
                         console.log("Music auto-play prevented after click:", error);
                         // musicStatusTextEl.textContent = 'Tap Play below'; // Inform user
                         // Optionally show the music placeholder if hidden
                         // musicPlaceholderEl.style.display = 'flex';
                     });
                 }
            }


            createFireworks();

             envelopeEl.classList.add('fade-out');

            setTimeout(() => {
                envelopeEl.style.display = 'none';
                 envelopeEl.classList.remove('fade-out');

                showStage(mainCardEl, 'main');
            }, 400);


        }

        // Stage 2: Show Thank You page
        function showThankYou() {
            if (currentStage !== 'main') return;

             hideStage(mainCardEl);
            showStage(thankYouSectionEl, 'thankYou');

             createConfetti(); // Trigger confetti on thank you page
        }

        // Back navigation logic
        function goBack() {
            if (currentStage === 'envelope') return;

            if (currentStage === 'thankYou') {
                hideStage(thankYouSectionEl);
                showStage(mainCardEl, 'main');
            } else if (currentStage === 'main') {
                hideStage(mainCardEl);
                showStage(envelopeEl, 'envelope');
            }
        }

        // Helper to show a stage and update state/button visibility
        function showStage(stageElement, stageName) {
            // Hide all *other* stage elements with animation
            document.querySelectorAll('.stage, .envelope-container').forEach(el => {
                if (el !== stageElement && el.style.display !== 'none') {
                     el.classList.add('fade-out');
                     setTimeout(() => {
                        el.style.display = 'none';
                        el.classList.remove('fade-out');
                     }, 500); // Match fadeOut duration
                }
            });

            // Remove shimmer from titles on *any* previous stage
            toggleShimmer(mainTitleEl, false); // Shimmer for main title
            toggleShimmer(thankYouTitleEl, false); // Shimmer for thank you title

            currentStage = stageName;

            if (stageName === 'envelope') {
                envelopeEl.style.display = 'flex';
                 envelopeEl.classList.remove('fade-out');
                 envelopeEl.style.animation = 'pulse-float 3s infinite ease-in-out';

                contentWrapperEl.style.display = 'none';
                backButtonEl.classList.add('hidden');


            } else {
                envelopeEl.style.display = 'none';
                envelopeEl.style.animation = ''; // Remove envelope animation

                contentWrapperEl.style.display = 'flex';
                contentWrapperEl.style.justifyContent = 'center';
                 contentWrapperEl.style.padding = '20px'; // Ensure padding exists

                // Use requestAnimationFrame + setTimeout to ensure stage is displayed before children animations trigger
                requestAnimationFrame(() => {
                    setTimeout(() => {
                        stageElement.style.display = 'block'; // Display the target stage

                        // Add shimmer after element is displayed and had time to animate in
                        if (stageElement === mainCardEl) {
                             setTimeout(() => toggleShimmer(mainTitleEl, true), 1000); // Apply shimmer to main title
                         } else if (stageElement === thankYouSectionEl) {
                            setTimeout(() => toggleShimmer(thankYouTitleEl, true), 600);
                        }

                        // Scroll to the top
                        contentWrapperEl.scrollTo({ top: 0, behavior: 'smooth' });
                    }, 50); // Short delay


                });


                backButtonEl.classList.remove('hidden');
            }
        }

        // Helper to hide a stage
        function hideStage(stageElement) {
             if (stageElement && stageElement.style.display !== 'none') {
                 stageElement.classList.add('fade-out');
                setTimeout(() => {
                    stageElement.style.display = 'none';
                    stageElement.classList.remove('fade-out');
                }, 500); // Match fadeOut duration
             }
        }


        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            document.body.classList.add('loaded'); // Make body visible

            createParticles();
            contentWrapperEl.style.display = 'none';
            // Explicitly show the initial envelope stage
            showStage(envelopeEl, 'envelope');
        });

    </script>
</body>
</html>